# Создадим zip-архив с шаблоном Mini App: HTML + JS для оплаты через PayPal
import zipfile
import os

# Создание структуры проекта
base_path = "/mnt/data/telegram_paypal_miniapp"
os.makedirs(base_path, exist_ok=True)

# miniapp.html - Основной HTML с кнопкой PayPal
html_content = """
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Subscribe</title>
  <script src="https://www.paypal.com/sdk/js?client-id=YOUR_PAYPAL_CLIENT_ID&currency=USD"></script>
</head>
<body>
  <h2>Subscribe to Telegram Channel</h2>
  <div id="paypal-button-container"></div>

  <script>
    Telegram.WebApp.ready();

    paypal.Buttons({
      createOrder: function (data, actions) {
        return actions.order.create({
          purchase_units: [{
            amount: { value: '5.00' }
          }]
        });
      },
      onApprove: function (data, actions) {
        return actions.order.capture().then(function (details) {
          fetch('https://your-backend.com/api/paypal-success', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              orderId: data.orderID,
              telegram_id: Telegram.WebApp.initDataUnsafe.user.id
            })
          }).then(() => Telegram.WebApp.close());
        });
      }
    }).render('#paypal-button-container');
  </script>
</body>
</html>
"""

# Сохраняем HTML файл
html_path = os.path.join(base_path, "miniapp.html")
with open(html_path, "w", encoding="utf-8") as f:
    f.write(html_content)

# Создание ZIP архива
zip_path = "/mnt/data/telegram_miniapp_paypal_template.zip"
with zipfile.ZipFile(zip_path, 'w') as zipf:
    zipf.write(html_path, arcname="miniapp.html")

zip_path
